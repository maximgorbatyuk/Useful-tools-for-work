# .NET Code Analyzer

A fast bash script that analyzes .NET/C# codebases to count meaningful lines of code, filtering out boilerplate and non-logic lines. Generated by Claude 4.5 Opus.

## Overview

This tool helps developers understand the actual complexity of their .NET projects by distinguishing between meaningful code and boilerplate. It recursively scans directories containing .NET repositories and provides detailed metrics per project and in aggregate.

## Features

- **Two report modes**:
  - **Single report** - All projects combined in one view
  - **Per-subfolder report** - Grouped by repository/subfolder with individual breakdowns
- **Interactive folder selector** - Choose which directory to analyze
- **Per-project breakdown** - See metrics grouped by each `.csproj` file
- **Smart line filtering** - Identifies and counts only meaningful code
- **NuGet dependency counting** - Tracks total package references
- **Optimized performance** - Uses AWK for fast file processing
- **Cross-platform compatible** - Works with bash 3.x+ (macOS, Linux)

## What Counts as "Meaningful Code"

The analyzer excludes the following from the meaningful code count:

| Excluded | Examples |
|----------|----------|
| Empty lines | Blank lines |
| Braces only | `{`, `}`, `};` |
| Using statements | `using System;` |
| Namespace declarations | `namespace MyApp` |
| Single-line comments | `// comment` |
| XML documentation | `/// <summary>` |
| Multi-line comments | `/* ... */` |
| LINQ method chains | `.Where(...)`, `.Select(...)` on new lines |
| Wrapped strings | String continuations with `+` |
| Attributes | `[HttpGet]`, `[Authorize]` |
| Preprocessor directives | `#region`, `#if`, `#pragma`, etc. |
| Auto-property accessors | `get;`, `set;`, `init;` |

## Output Metrics

### Single Report Mode

| Metric | Description |
|--------|-------------|
| **Project files** | Count of `*.csproj` files found |
| **C# source files** | Count of `*.cs` files found |
| **NuGet dependencies** | Total `<PackageReference>` entries across all projects |
| **Non-empty lines** | Total lines excluding blank lines |
| **Meaningful code lines** | Lines containing actual logic |
| **Code efficiency ratio** | Percentage of meaningful lines vs total non-empty |

### Per-Subfolder Report Mode

In addition to the above metrics, per-subfolder mode provides:

| Metric | Description |
|--------|-------------|
| **Analyzed subfolders** | Count of subfolders containing .NET projects |
| **Per-subfolder breakdown** | Detailed metrics for each repository/subfolder |
| **Average ratio per subfolder** | Mean efficiency ratio across all analyzed subfolders |

## Installation

1. Download the script:
```bash
curl -O https://path-to-script/analyze-dotnet.sh
```

2. Make it executable:
```bash
chmod +x analyze-dotnet.sh
```

3. Place it in your parent directory containing .NET repositories.

## Usage

```bash
./analyze-dotnet.sh
```

### Step 1: Report Mode Selection

When launched, the script first asks you to choose a report mode:

```
╔════════════════════════════════════════════════════════════╗
║              .NET Code Analyzer - Report Mode              ║
╚════════════════════════════════════════════════════════════╝

  [1] Single report (all projects combined)
  [2] Per-subfolder report (grouped by repository/subfolder)
  [q] Quit

Select report mode [1-2, q]:
```

### Step 2: Folder Selection

After selecting the report mode, choose which directory to analyze:

```
╔════════════════════════════════════════════════════════════╗
║           .NET Code Analyzer - Folder Selection            ║
╚════════════════════════════════════════════════════════════╝

Current directory: /home/user/projects

Available folders:

  [1] . (Current directory)
  [2] .. (Parent directory)
  [3] MyWebApi
  [4] SharedLibrary
  [5] BackendServices

  [c] Enter custom path
  [q] Quit

Select folder to analyze [1-5, c, or q]:
```

### Sample Output: Single Report Mode

```
╔══════════════════════════════════════════════════════════════════════════════════════════════╗
║                                    Projects Breakdown                                        ║
╠══════════════════════════════════════════════════════════════════════════════════════════════╣
║ Project                                     Files      NuGet    Non-Empty  Meaningful    Ratio ║
╠══════════════════════════════════════════════════════════════════════════════════════════════╣
║ MyWebApi.Core                                  45         12        3500       2100      60.0% ║
║ MyWebApi.Services                              32          8        2200       1450      65.9% ║
║ MyWebApi.Infrastructure                        28         15        1800       1100      61.1% ║
║ MyWebApi.Tests                                 20          5         900        650      72.2% ║
╚══════════════════════════════════════════════════════════════════════════════════════════════╝

╔════════════════════════════════════════════════════════════╗
║                       Summary Totals                       ║
╠════════════════════════════════════════════════════════════╣
║ Total project files (*.csproj):                          4 ║
║ Total C# source files (*.cs):                          125 ║
║ Total NuGet dependencies:                               40 ║
╠════════════════════════════════════════════════════════════╣
║ Total non-empty lines:                                8400 ║
║ Total meaningful code lines:                          5300 ║
║ Overall code efficiency ratio:                       63.1% ║
╚════════════════════════════════════════════════════════════╝
```

### Sample Output: Per-Subfolder Report Mode

Each subfolder gets its own detailed breakdown:

```
╔══════════════════════════════════════════════════════════════════════════════════════════════╗
║ Repository: MyWebApi
╠══════════════════════════════════════════════════════════════════════════════════════════════╣
║ Project                                     Files      NuGet    Non-Empty  Meaningful    Ratio ║
╠══════════════════════════════════════════════════════════════════════════════════════════════╣
║ MyWebApi.Core                                  45         12        3500       2100      60.0% ║
║ MyWebApi.Services                              32          8        2200       1450      65.9% ║
╠══════════════════════════════════════════════════════════════════════════════════════════════╣
║ SUBTOTAL                                       77         20        5700       3550      62.3% ║
╚══════════════════════════════════════════════════════════════════════════════════════════════╝

╔══════════════════════════════════════════════════════════════════════════════════════════════╗
║ Repository: SharedLibrary
╠══════════════════════════════════════════════════════════════════════════════════════════════╣
║ Project                                     Files      NuGet    Non-Empty  Meaningful    Ratio ║
╠══════════════════════════════════════════════════════════════════════════════════════════════╣
║ SharedLibrary.Common                           25          5        1200        850      70.8% ║
║ SharedLibrary.Extensions                       15          3         600        420      70.0% ║
╠══════════════════════════════════════════════════════════════════════════════════════════════╣
║ SUBTOTAL                                       40          8        1800       1270      70.6% ║
╚══════════════════════════════════════════════════════════════════════════════════════════════╝
```

Followed by a grand summary:

```
╔══════════════════════════════════════════════════════════════════════════════════════════════╗
║                              GRAND SUMMARY (All Subfolders)                                  ║
╠══════════════════════════════════════════════════════════════════════════════════════════════╣
║ Subfolder                                   Files      NuGet    Non-Empty  Meaningful    Ratio ║
╠══════════════════════════════════════════════════════════════════════════════════════════════╣
║ MyWebApi                                       77         20        5700       3550      62.3% ║
║ SharedLibrary                                  40          8        1800       1270      70.6% ║
╚══════════════════════════════════════════════════════════════════════════════════════════════╝

╔════════════════════════════════════════════════════════════╗
║                       GRAND TOTALS                         ║
╠════════════════════════════════════════════════════════════╣
║ Analyzed subfolders with .NET projects:                  2 ║
║ Total project files (*.csproj):                          6 ║
║ Total C# source files (*.cs):                          117 ║
║ Total NuGet dependencies:                               28 ║
╠════════════════════════════════════════════════════════════╣
║ Total non-empty lines:                                7500 ║
║ Total meaningful code lines:                          4820 ║
║ Overall code efficiency ratio:                       64.3% ║
║ Average ratio per subfolder:                         66.5% ║
╚════════════════════════════════════════════════════════════╝
```

## Requirements

- **Bash 3.x or higher** (compatible with macOS default bash)
- **Standard Unix utilities**: `find`, `grep`, `awk`, `sed`, `wc`, `sort`, `md5sum` (or `md5` on macOS)

## Directory Structure

The script expects to be placed in a parent directory containing one or more .NET repositories:

```
projects/
├── analyze-dotnet.sh
├── Repository1/
│   ├── src/
│   │   ├── Project1/
│   │   │   ├── Project1.csproj
│   │   │   └── *.cs files
│   │   └── Project2/
│   │       ├── Project2.csproj
│   │       └── *.cs files
│   └── tests/
│       └── Project1.Tests/
│           ├── Project1.Tests.csproj
│           └── *.cs files
└── Repository2/
    └── ...
```

## Performance

The script uses AWK for file processing instead of bash line-by-line reading, providing **5-10x faster** analysis compared to pure bash implementations. Additional optimizations include:

- Directory lookup caching for project association
- Efficient file discovery with `find`
- Minimal subshell spawning

## Notes

- Files not associated with any `.csproj` are grouped under "(Files without project)"
- The script uses temporary files for data storage (automatically cleaned up on exit)
- Only `*.cs` files are analyzed; other file types are ignored
- Subfolders without any `.csproj` files are automatically skipped in per-subfolder mode
- Projects are sorted by meaningful code lines (descending) in all views

## License

MIT License - Feel free to use and modify as needed.